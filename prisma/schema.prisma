generator client {
  provider = "prisma-client"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum VerificationState {
  PENDING
  ACCEPTED
  REJECTED
}

model User {
  id           String @id @default(uuid()) @db.Uuid
  email        String @unique
  passwordHash String @map("password_hash")
  name         String @unique
  phone        String // TIDAK Sesuai

  birthDate  DateTime? @map("birth_date") @db.Date
  birthPlace String?   @map("birth_place")
  nik        String?

  hasKtp     Boolean @default(false) @map("has_ktp")
  hasProfile Boolean @default(false) @map("has_profile")

  verificationState            VerificationState @default(PENDING) @map("verification_state")
  verificationStateChangedTime DateTime?         @map("verification_state_changed_time")

  products      Product[]
  carts         Cart[]
  userAddresses UserAddress[]

  @@map("users")
}

model UserAddress {
  id      String @id @default(uuid()) @db.Uuid
  name    String
  address String

  userId String @map("user_id") @db.Uuid

  user User @relation(fields: [userId], references: [id])

  @@map("user_addresses")
}

model Product {
  id    String   @id @default(uuid()) @db.Uuid
  name  String
  price Int
  specs String[]
  stock Int

  userId String @db.Uuid

  user  User   @relation(fields: [userId], references: [id])
  rents Rent[]

  @@map("products")
}

// RELASI Salah
model Cart {
  id String @id @default(uuid()) @db.Uuid

  userId    String  @map("user_id") @db.Uuid
  paymentId String? @map("payment_id") @db.Uuid

  user    User     @relation(fields: [userId], references: [id])
  rents   Rent[]
  payment Payment? @relation(fields: [paymentId], references: [id])

  @@map("carts")
}

enum RequestState {
  PENDING
  ACCEPTED
  REJECTED
}

// RELASI SALAH
model Rent {
  id          String    @id @default(uuid()) @db.Uuid
  startDate   DateTime? @map("start_date") @db.Date
  durationDay Int       @map("duration_day")
  rentPrice   Int?      @map("rent_price")
  needDeliver Boolean   @map("need_deliver")

  productId String @map("product_id") @db.Uuid
  cartId    String @map("cart_id") @db.Uuid

  product Product @relation(fields: [productId], references: [id])
  cart    Cart    @relation(fields: [cartId], references: [id])

  requestState RequestState @default(PENDING)

  @@map("rents")
}

model Payment {
  id     String  @id @default(uuid()) @db.Uuid
  amount Int
  isPaid Boolean @map("is_paid")

  carts Cart[]
}
